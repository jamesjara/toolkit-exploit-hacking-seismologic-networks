#!/usr/bin/perl

use warnings;
use strict;

my $file = $ARGV[0];
my $regex = $ARGV[1];

open FILE, "<$file" || die "Cannot open $file";

while(<FILE>) {
next if /^\n$|^#.*$/; # ignore comments and blank lines
next if /Status/; # ignore status lines
chomp;
# match line
# $1 IP
# $2 hostname
# $3 ports in nmap notation
next if not /^Host: ([\d\.]+) \((.*)\)\tPorts: (.+)(\t.*)*$/;

my $ip = $1;
my $host = $2;
my @ports = split /, /, $3;
my @ports2 = ();
foreach my $port (@ports) {
next if $port !~ /$regex/i; # use given regex as filter for ports
$port =~ /^(\d+).*$/;
push( @ports2,  "\t$1" );
#print "$ip,$host,$1\n";
} # foreach
print "$ip \t @ports2\n";
} # while

close FILE;
